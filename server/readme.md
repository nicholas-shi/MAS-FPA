# MAS-FPA Backend

## Getting Started
1. After cloning / pulling the repo, make sure to run an `npm install` in the server directory (`cd server`)
2. Create a `.env` file in the `server` directory with a the following fields:
```
mongoURI=mongodb+srv://<username>:<password>@<mongodb-cluster-id>.mongodb.net/<database_name>?retryWrites=true&w=majority
jwtSecret=<some_jwt_secret>
```
    Note: you can get the above mongoURI inside MongoDB Atlas dashboard. Navigate to your database and click on "connect." This should give you your mongoURI, from which you only need to paste in your password in the field <password>.

    Also, the jwtSecret can be literally anything. Just keep it secret.

3. For development,run `npm run dev` inside the `server` directory. If production, run `npm run start`.

## Making Requests to the API

To interact with todos in the database, you can make requests to this API. For these examples, I will use the hostname `localhost`, as this is what you will use when testing this locally. In production, replace this with your domain/hostname.

I suggest using [Postman](https://www.postman.com/) or [Insomnia](https://insomnia.rest/). If you use Insomnia, I have included the collection in `server/MAS-FPA.json`. You can import the collection into Insomnia by going to `Preferences > Data > Import Data > From File` and select `MAS-FPA.json`.

---

## API Documentation / Reference

### `GET http://localhost:5000/api/todo/all`
- **Description:** GET all todos in the database with option to limit how many are returned.
- **Params:** None
- **Body:** (optional) Provide a `limit` field to limit the number of objects returned.
Example:
```json
{
    "limit": 2
}
```
- **Returns**: Array of todo/task JSONs. Contains _id, name, created date, and (optional) description.
e.g.:
```json
[
  {
    "_id": "613b9c267bc365e9e79954d1",
    "name": "Become the president",
    "description": "Run for president in 2024",
    "created": "2021-09-10T17:55:50.163Z",
    "__v": 0
  },
  {
    "_id": "613ba1a1e9e02712942d7815",
    "name": "Complete my homework",
    "description": "i have 10 assignments due by Friday night. Finish assignments 2, 3, 6, and 7 first.",
    "created": "2021-09-10T18:19:13.129Z",
    "__v": 0
  }
]
```

### `GET http://localhost:5000/api/todo/:id`
- **Description:** Get a single todo by id. Id is auto-generated by mongo.
- **Params:** (required) **id** | Example:
```
GET http://localhost:5000/api/todo/613b9c267bc365e9e79954d1
```
- **Body:** *none*
- **Returns**: A single todo JSON with provided id
e.g.:
```json
{
  "_id": "613b9c267bc365e9e79954d1",
  "name": "Become the president",
  "description": "Run for president in 2024",
  "created": "2021-09-10T17:55:50.163Z",
  "__v": 0
}
```

### `POST http://localhost:5000/api/todo/`
- **Description:** Create a new todo
- **Params:** *none*
- **Body:** (json)
    - (required) name
    - (optional) description

    - Example
```json
{
    "name": "Complete my homework",
    "description": "i have 10 assignments due by Friday night. Finish assignments 2, 3, 6, and 7 first."
}
```
- **Returns**: A JSON containing the todo along with a `msg` field stating it was successful:

e.g.:
```json
{
  "msg": "Todo successfully created",
  "todo": {
    "name": "Complete my homework",
    "description": "i have 10 assignments due by Friday night. Finish assignments 2, 3, 6, and 7 first.",
    "_id": "613ba1a1e9e02712942d7815",
    "created": "2021-09-10T18:19:13.129Z",
    "__v": 0
  }
}
```

### `PUT http://localhost:5000/api/todo/:id`
- **Description:** Update a single todo, by id
- **Params:** (required) **id** | Example:
```
PUT http://localhost:5000/api/todo/613b9c267bc365e9e79954d1
```
- **Body:** (json)
    - (required) name
    - (optional) description
    - Example:
```json
{
	"name": "Become the president... later",
	"description": "Run for president in 2028"
}
```
- **Returns**: A single todo JSON with provided id
e.g.:
```json
{
  "msg": "Updated todo",
  "todo": {
    "name": "Become the president... later",
    "description": "Run for president in 2028"
  }
}
```

### `DELETE http://localhost:5000/api/todo/:id`
- **Description:** Delete a single todo by id.
- **Params:** (required) **id** | Example:
```
DELETE http://localhost:5000/api/todo/613b9c267bc365e9e79954d1
```
- **Body:** *none*
- **Returns**: A single todo JSON with a message informing successful deletion of todo.
e.g.:
```json
{
  "msg": "Todo removed"
}
```

---

## User Authentication

Users are stored in a database collection. At the moment, the only fields available for a user registration are:

- username (required)
- password (required)
- firstname (required)
- lastname (required)

All passwords are salted and hashed using `bcrypt`.

### `POST http://localhost:5000/api/users/`
- **Description:** Register a user 
- **Params:** *none*
- **Body:** (JSON)

Example
```json
{
	"username": "test",
	"password": "password",
	"firstname": "first name",
	"lastname": "last name"
}
```
- **Returns**: A JSON containing a token
e.g.:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoiNjEzYmMwZjc4ZGQzN2Y2OGYzNWRiZmZmIn0sImlhdCI6MTYzMTMwNTk3NiwiZXhwIjoxNjMxNjY1OTc2fQ.SGbJFvTRDCFgc8luGDHdf_-gNkgV-r4woOxnZCKTG18"
}
```

### `POST http://localhost:5000/api/auth/`
- **Description:** Authenticate (login) a user 
- **Params:** *none*
- **Body:** (JSON)

Example
```json
{
	"username": "test",
	"password": "password",
}
```
- **Returns**: A JSON containing a token
e.g.:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoiNjEzYmMwZjc4ZGQzN2Y2OGYzNWRiZmZmIn0sImlhdCI6MTYzMTMwNTk3NiwiZXhwIjoxNjMxNjY1OTc2fQ.SGbJFvTRDCFgc8luGDHdf_-gNkgV-r4woOxnZCKTG18"
}
```

### `GET http://localhost:5000/api/auth/`
- **Description:** Get the user from the token
- **Headers:** `x-auth-token`

This is the JWT you would get from registering or logging a user in. For example:
```
x-auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoiNjEzYmMwZjc4ZGQzN2Y2OGYzNWRiZmZmIn0sImlhdCI6MTYzMTMwNTk3NiwiZXhwIjoxNjMxNjY1OTc2fQ.SGbJFvTRDCFgc8luGDHdf_-gNkgV-r4woOxnZCKTG18
```
- **Params:** *none*
- **Body:** *none*
- **Returns**: A JSON containing a token
e.g.:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoiNjEzYmMwZjc4ZGQzN2Y2OGYzNWRiZmZmIn0sImlhdCI6MTYzMTMwNTk3NiwiZXhwIjoxNjMxNjY1OTc2fQ.SGbJFvTRDCFgc8luGDHdf_-gNkgV-r4woOxnZCKTG18"
}
```